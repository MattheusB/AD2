---
title: "Predição de Eleição de Deputados"
author: "Mattheus Brito"
date: "30/11/2018"
output: html_document
---

# Introdução
Esta análise será feita utilizando conhecimentos sobre classificação para prever quais candidatos à Câmara de Deputados serão eleitos nas eleições de 2014. Logo abaixo será respondido 5 perguntas propostas pela organização da cadeira de Análise de Dados 2, tomando como base os dados fornecidos.

Antes de tudo será importado as nossas bibliotecas que serão utilizadas para a plotagem das análises para responder as questões.

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(plotly)
library(caret)
library(ROSE)

```

Logo após, será importado a nossa base de dados, sendo elas: train.csv (conjunto de treino que contém dados das eleições do ano de 2014), test.csv (conjunto de teste que contém dados das eleições de 2014). Assim como:

* Modificar três novos campos para auxiliar na criação do modelo. Esses campos serão nomeados de "isHomem", "isDeputado" e "isSuperior", esses campos será derivados dos campos "sexo", "ocupacao" e "grau", respectivamente. O motivo dessa derivação é que os três campos mencionados anteriormente possuem muitos fatores, e isso demanda uma maior parte de tempo para a produção do modelo. Desse modo, modificando elas, terá uma redução de tempo significativa na geração do modelo.

* Remover informações que tem pouca relevância, nome, partido, uf, total_despesa, estado_civil, ocupacao, sexo, grau que iriam demandar um custo elevado de tempo e atrapalhar no processo de tunagem.

```{r}
treino <- read.csv("~/Downloads/AD2/Lab03/all/train.csv")
teste <- read.csv("~/Downloads/AD2/Lab03/all/test.csv")

treino <- treino %>%
  mutate(isHomem = ifelse (sexo=="HOMEM", TRUE, FALSE),
         isDeputado = ifelse (ocupacao=="DEPUTADO", TRUE, FALSE),
         isSuperior = ifelse (grau=="SUPERIOR COMPLETO", TRUE, FALSE)
         )
teste <- teste %>%
  mutate(isHomem = ifelse(sexo=="MASCULINO", TRUE, FALSE),
         isDeputado = ifelse (ocupacao=="DEPUTADO", TRUE, FALSE),
         isSuperior = ifelse(grau=="SUPERIOR COMPLETO", TRUE, FALSE)
         )

treino <- treino %>%
  select(-c(nome, partido, uf, total_despesa, estado_civil, ocupacao, sexo, grau))

teste <- teste%>%
  select(-c(nome, partido, uf, total_despesa, estado_civil, ocupacao, sexo, grau))
```

Antes de partir para as perguntas, é necessário entender o que cada coluna presente nos nossos dados significa:

* ano: Ano da eleição;
* sequencial_candidato: O identificador do candidato. Corresponde à coluna Id do arquivo de submissão;
* nome: Nome do candidato;
* uf: Sigla do estado do candidato;
* partido: Partido do candidato;
* quantidade_doacoes: Número de doações que um candidato recebeu;
* quantidade_doadores: Numero de doadores que um candidato teve;
* total_receita: Total de receita de um candidato;
* media_receita: Média da receita de um candidato;
* recursos_de_outros_candidatos.comites: Total de receita proveniente de outros candidatos e * comitês;
* recursos_de_pessoas_fisicas: Total de receita proveniente de pessoas físicas;
* recursos_de_pessoas_juridicas: Total de receita proveniente de pessoas juridicas;
* recursos_proprios:Total de receita proveniente dos próprios candidatos;
* recursos_de_partido_politico: Total de receita proveniente do partido do candidato;
* quantidade_despesas: Número de despesas que um candidato teve;
* quantidade_fornecedores: Número de fornecedores que um candidato teve;
* total_despesa: Total de depesa de um candidato;
* media_despesa: Média da despesa de um candidato;
* cargo: Cargo ao qual o candidato está concorrendo;
* sexo: Sexo do candidato;
* grau: Grau de escolaridade do candidato;
* estado_civil: Estado civil do candidato;
* ocupacao: Ocupação do candidato;
* situacao: Situação final do candidato. Corresponde à coluna Predict do arquivo de submissão;

# Perguntas

#### 1 - Há desbalanceamento das classes (isto é, uma classe tem muito mais instâncias que outra)? Em que proporção? Quais efeitos colaterais o desbalanceamento de classes pode causar no classificador? Como você poderia tratar isso?

Para responder essa pergunta utilizaremos um gráfico de barras que vai exibir o número de deputados eleitos e não eleitos.

```{r}
situacaoParlamentares <-treino %>% 
  group_by(situacao) %>% 
    summarise(total = n())
situacaoParlamentares %>%
  plot_ly(y = ~total, type = "bar", color = ~situacao) %>%
  layout(title = "Número de Deputados eleitos ou não eleitos",
         yaxis = list(title = "Total de Parlamentares"),
         xaxis = list (title = "Eleito ou não eleito"))
```

No gráfico acima, pode-se enxergar que há uma grande discrepância entre o número de canditados eleitos e o número de candidatos não eleitos, ou seja, as classes são desbalanceadas em uma proporção de que o número de candidatos não eleitos é 6 vezes maior que o número de candidatos eleitos. Desse modo, isso pode prejudicar a análise tornando o seu resultado enviezado. Sendo assim, é necessário que haja um balanceamento entre as classes fornecidas. Para isso existem 3 modos eficazes:

* Over
```{r}
treinoOver <- ovun.sample(situacao~., data=treino,p=0.5, seed=1,method="over")$data

plotOver <- treinoOver %>% 
  group_by(situacao) %>% 
    summarise(total = n())

plotOver %>%
  plot_ly(y = ~total, type = "bar", color = ~situacao) %>%
  layout(title = "Número de Deputados eleitos ou não eleitos",
         yaxis = list(title = "Total de Parlamentares"),
         xaxis = list (title = "Eleito ou não eleito"))
```
Como pode ser visto no gráfico acima o método "over", aumenta o parâmetro que está em menor vigor, elevando o número de candidatos eleitos para 6542.

* Under
```{r}
treinoUnder <- ovun.sample(situacao~., data=treino,p=0.5, seed=1,method="under")$data

plotUnder <- treinoUnder %>% 
  group_by(situacao) %>% 
    summarise(total = n())

plotUnder %>%
  plot_ly(y = ~total, type = "bar", color = ~situacao) %>%
  layout(title = "Número de Deputados eleitos ou não eleitos",
         yaxis = list(title = "Total de Parlamentares"),
         xaxis = list (title = "Eleito ou não eleito"))

```
Observando o gráfico acima vemos que o "under", diminui o parâmetro que está em maior vigor, diminuindo o número de para 982.

* Both
```{r}
treinoBoth <- ovun.sample(situacao~., data=treino,p=0.5, seed=1,method="both")$data

plotBoth <- treinoBoth %>% 
  group_by(situacao) %>% 
    summarise(total = n())

plotBoth %>%
  plot_ly(y = ~total, type = "bar", color = ~situacao) %>%
  layout(title = "Número de Deputados eleitos ou não eleitos",
         yaxis = list(title = "Total de Parlamentares"),
         xaxis = list (title = "Eleito ou não eleito"))
```
E por fim o gráfico acima retrata o "both", que vai mesclar os dois métodos anteriores. Alterando o número tanto de candidatos eleitos quanto o de não eleitos, deixando com 3842 e 3780, respectivamente.

Na análise, foi optado por usar o "both", baseado no fato de que se utilizasse o método "over", vários outros dados teriam que ser criados e isso poderia afetar no resultado final e se utilizasse o método "under" sobraria poucos dados para executar a análise. Sendo assim, o método "both" iria ser um meio termo entre o "over" e o "under".

#### 2 - Treine: um modelo de KNN, regressão logística, uma árvore de decisão e um modelo de adaboost. Tune esses modelos usando validação cruzada e controle overfitting se necessário, considerando as particularidades de cada modelo.

```{r}

```

#### 3 - Reporte precision, recall e f-measure no treino e validação. Há uma grande diferença de desempenho no treino/validação? Como você avalia os resultados? Justifique sua resposta.

```{r}

```

#### 4 - Interprete as saídas dos modelos. Quais atributos parecem ser mais importantes de acordo com cada modelo?

```{r}

```

#### 5 - Envie seus melhores modelos à competição do Kaggle. Faça pelo menos uma submissão. Sugestões para melhorar o modelo: